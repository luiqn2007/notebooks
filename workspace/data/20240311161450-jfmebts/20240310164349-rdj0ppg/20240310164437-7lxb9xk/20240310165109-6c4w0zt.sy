{"ID":"20240310165109-6c4w0zt","Spec":"1","Type":"NodeDocument","Properties":{"id":"20240310165109-6c4w0zt","title":"可协作中断","updated":"20240310165115"},"Children":[{"ID":"20240310165115-rxdayrv","Type":"NodeParagraph","Properties":{"id":"20240310165115-rxdayrv","updated":"20240310165115"},"Children":[{"Type":"NodeText","Data":"通过外部请求，影响线程内部是否中断并退出"}]},{"ID":"20240310165115-395fgsl","Type":"NodeList","ListData":{},"Properties":{"id":"20240310165115-395fgsl","updated":"20240310165115"},"Children":[{"ID":"20240310165115-k96scmq","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240310165115-k96scmq","updated":"20240310165115"},"Children":[{"ID":"20240310165115-j33dn11","Type":"NodeParagraph","Properties":{"id":"20240310165115-j33dn11","updated":"20240310165115"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"std::stop_token"},{"Type":"NodeText","Data":"​：查询线程是否中断"}]}]},{"ID":"20240310165115-he3rkq1","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240310165115-he3rkq1","updated":"20240310165115"},"Children":[{"ID":"20240310165115-si4p7vq","Type":"NodeParagraph","Properties":{"id":"20240310165115-si4p7vq","updated":"20240310165115"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"std::stop_source"},{"Type":"NodeText","Data":"​：请求线程停止运行"}]}]},{"ID":"20240310165115-0oilmsw","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240310165115-0oilmsw","updated":"20240310165115"},"Children":[{"ID":"20240310165115-3qut9ch","Type":"NodeParagraph","Properties":{"id":"20240310165115-3qut9ch","updated":"20240310165115"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"std::stop_callback"},{"Type":"NodeText","Data":"​：终止时触发的回调函数"}]}]}]},{"ID":"20240310165115-ud5q5is","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240310165115-ud5q5is","updated":"20240310165115"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yysr"},{"Type":"NodeCodeBlockCode","Data":"void Test() {\n    std::jthread th;\n    {\n        th = std::jthread([](const std::stop_token st) {\n            while (!st.stop_requested()) {\n                // 没有收到中断请求，则执行\n                std::cout \u003c\u003c \"1\";\n                Sleep(500);\n            }\n        });\n    }\n    Sleep(10 * 1000);\n    // 外部发起中断请求\n    auto ret = th.request_stop();\n}\n\nint main(int argc, char* argv[]) {\n    Test();\n    std::cout \u003c\u003c std::endl;\n    return 0;\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]}