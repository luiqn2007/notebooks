{"ID":"20240312030706-jrp2t72","Spec":"1","Type":"NodeDocument","Properties":{"id":"20240312030706-jrp2t72","title":"入口","updated":"20240312030755"},"Children":[{"ID":"20240312030716-sh18wlq","Type":"NodeParagraph","Properties":{"id":"20240312030716-sh18wlq","updated":"20240312030716"},"Children":[{"Type":"NodeText","Data":"JavaAgent 的入口分为两种，对应 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Load-Time Insatrumentation"},{"Type":"NodeText","Data":"​ 和 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Dynamic Insatrumentation"},{"Type":"NodeText","Data":"​。二者声明仅入口函数名不同，参数相同"}]},{"ID":"20240312030716-1sgkf12","Type":"NodeList","ListData":{},"Properties":{"id":"20240312030716-1sgkf12","updated":"20240312030716"},"Children":[{"ID":"20240312030716-hh5ic7x","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240312030716-hh5ic7x","updated":"20240312030716"},"Children":[{"ID":"20240312030716-tmueexj","Type":"NodeParagraph","Properties":{"id":"20240312030716-tmueexj","updated":"20240312030716"},"Children":[{"Type":"NodeText","Data":"Load-Time Insatrumentation：premain"}]}]},{"ID":"20240312030716-atuumo3","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240312030716-atuumo3","updated":"20240312030716"},"Children":[{"ID":"20240312030716-7fflpk1","Type":"NodeParagraph","Properties":{"id":"20240312030716-7fflpk1","updated":"20240312030716"},"Children":[{"Type":"NodeText","Data":"Dynamic Insatrumentation：agentmain"}]}]}]},{"ID":"20240312030716-encxzc1","Type":"NodeParagraph","Properties":{"id":"20240312030716-encxzc1","updated":"20240312030716"},"Children":[{"Type":"NodeText","Data":"两种入口每种都支持以下两种声明，第一种的优先级更高，以 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"premain"},{"Type":"NodeText","Data":"​ 为例："}]},{"ID":"20240312030716-figp2at","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20240312030716-figp2at","updated":"20240312030716"},"Children":[{"ID":"20240312030716-04tw9jg","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20240312030716-04tw9jg","updated":"20240312030716"},"Children":[{"ID":"20240312030716-y3e1xuq","Type":"NodeParagraph","Properties":{"id":"20240312030716-y3e1xuq","updated":"20240312030716"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"public static void premain(String args, Instrumentation inst)"},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20240312030716-uru21c2","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20240312030716-uru21c2","updated":"20240312030716"},"Children":[{"ID":"20240312030716-9kcq2lz","Type":"NodeParagraph","Properties":{"id":"20240312030716-9kcq2lz","updated":"20240312030716"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"public static void premain(String args)"},{"Type":"NodeText","Data":"​"}]}]}]},{"ID":"20240312030716-epuyk8r","Type":"NodeParagraph","Properties":{"id":"20240312030716-epuyk8r","updated":"20240312030716"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"java.lang.instrument.Instrumentation"},{"Type":"NodeText","Data":"​ 实例是核心部分，集中了几乎所有的功能和方法。"}]},{"ID":"20240312030716-gqf5nx4","Type":"NodeParagraph","Properties":{"id":"20240312030716-gqf5nx4","updated":"20240312030716"},"Children":[{"Type":"NodeText","Data":"打包时，应在 Manifest 中添加以下内容："}]},{"ID":"20240312030716-m41sxfd","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240312030716-m41sxfd","updated":"20240312030716"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"# META-INF/MANIFEST.MF\n\n# 两种入口函数注册\nPremain-Class: premain 方法所在类\nAgent-Class: agentmain 方法所在类\n\n# 开启更多功能\nCan-Redefine-Classes: true\nCan-Retransform-Classes: true\nCan-Set-Native-Method-Prefix: true\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240312030716-545qwjl","Type":"NodeParagraph","Properties":{"id":"20240312030716-545qwjl","updated":"20240312030716"},"Children":[{"Type":"NodeText","Data":"另外，若用到 JVM 自带的 ASM，还需要 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"-XDignore.symbol.file"},{"Type":"NodeText","Data":"​ 参数忽略找不到的类"}]},{"ID":"20240312030716-mmzzgab","Type":"NodeList","ListData":{},"Properties":{"id":"20240312030716-mmzzgab","updated":"20240312030716"},"Children":[{"ID":"20240312030716-q5xilzu","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240312030716-q5xilzu","updated":"20240312030716"},"Children":[{"ID":"20240312030716-e4vvtai","Type":"NodeParagraph","Properties":{"id":"20240312030716-e4vvtai","updated":"20240312030716"},"Children":[{"Type":"NodeText","Data":"原因：javac 默认不直接使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"rt.jar"},{"Type":"NodeText","Data":"​ 而是使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"lib/ct.sym"},{"Type":"NodeText","Data":"​ 中的符号表"}]}]}]},{"ID":"20240312030747-mr1g6pc","Type":"NodeParagraph","Properties":{"id":"20240312030747-mr1g6pc","style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);","updated":"20240312030754"},"Children":[{"Type":"NodeText","Data":"若一个应用程序 jar 包（带 main 函数）自带 JavaAgent，应在 Manifest 中定义 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);"},"TextMarkType":"code","TextMarkTextContent":"Launcher-Agent-Class"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);\"}"},{"Type":"NodeText","Data":"​ 属性，使用 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);"},"TextMarkType":"code","TextMarkTextContent":"agentmain"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);\"}"},{"Type":"NodeText","Data":"​ 作为方法名，但起到 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);"},"TextMarkType":"code","TextMarkTextContent":"Load-Time Instrumentation"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);\"}"},{"Type":"NodeText","Data":"​ 的效果，且第一个参数字符串总为空"}]},{"ID":"20240312030755-1wqs4ds","Type":"NodeParagraph","Properties":{"id":"20240312030755-1wqs4ds"}}]}