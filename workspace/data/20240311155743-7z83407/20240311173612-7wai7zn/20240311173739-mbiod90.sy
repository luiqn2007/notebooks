{"ID":"20240311173739-mbiod90","Spec":"1","Type":"NodeDocument","Properties":{"id":"20240311173739-mbiod90","title":"例：DISCARD 服务器","updated":"20240311175900"},"Children":[{"ID":"20240311175821-0zodlm2","Type":"NodeParagraph","Properties":{"id":"20240311175821-0zodlm2","updated":"20240311175900"},"Children":[{"Type":"NodeText","Data":"一个接收任何数据，并将其直接抛弃，不响应任何数据的服务器"}]},{"ID":"20240311174430-es28jak","Type":"NodeSuperBlock","Properties":{"id":"20240311174430-es28jak","updated":"20240311175811"},"Children":[{"Type":"NodeSuperBlockOpenMarker"},{"Type":"NodeSuperBlockLayoutMarker","Data":"col"},{"ID":"20240311173818-7b2flmt","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240311173818-7b2flmt","style":"width: 67%; flex: 0 0 auto;","updated":"20240311173818"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"public class DiscardServer {\n\n    private final int port;\n\n    public DiscardServer(int port) {\n        this.port = port;\n    }\n\n    public void run() throws InterruptedException {\n        EventLoopGroup boss = new NioEventLoopGroup();\n        EventLoopGroup worker = new NioEventLoopGroup();\n        try {\n            ServerBootstrap bootstrap = new ServerBootstrap();\n            bootstrap.group(boss, worker)\n                    .channel(NioServerSocketChannel.class)\n                    .childHandler(new ChannelInitializer\u003cSocketChannel\u003e() {\n                        @Override\n                        protected void initChannel(SocketChannel ch) {\n                            ch.pipeline().addLast(new DiscardServerHandler());\n                        }\n                    })\n                    .option(ChannelOption.SO_BACKLOG, 128)\n                    .childOption(ChannelOption.SO_KEEPALIVE, true);\n\n            ChannelFuture future = bootstrap.bind(port).sync();\n            future.channel().closeFuture().sync();\n        } finally {\n            worker.shutdownGracefully();\n            boss.shutdownGracefully();\n        }\n    }\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240311174426-uy1syia","Type":"NodeSuperBlock","Properties":{"id":"20240311174426-uy1syia","updated":"20240311174712"},"Children":[{"Type":"NodeSuperBlockOpenMarker"},{"Type":"NodeSuperBlockLayoutMarker","Data":"row"},{"ID":"20240311173907-ox8y1mq","Type":"NodeParagraph","Properties":{"id":"20240311173907-ox8y1mq","updated":"20240311174427"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"EventLoopGroup"},{"Type":"NodeText","Data":"​：处理传输的 IO 多线程事件循环器，通常使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"NioEventLoopGroup"},{"Type":"NodeText","Data":"​，负责线程池和接收信息的调度。"}]},{"ID":"20240311174019-3h6apio","Type":"NodeParagraph","Properties":{"id":"20240311174019-3h6apio","updated":"20240311174427"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ServerBootstrap"},{"Type":"NodeText","Data":"​：服务器 NIO 启动辅助类。一般不会直接从该类使用 Channel"}]},{"ID":"20240311174052-0irudlu","Type":"NodeTable","TableAligns":[0,0],"Properties":{"colgroup":"min-width: 60px;|min-width: 60px;","id":"20240311174052-0irudlu","updated":"20240311174427"},"Children":[{"Type":"NodeTableHead","Data":"thead","Children":[{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"方法"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"说明"}]}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"group"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"注册事件循环器"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"channel"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"决定如何将传入的连接转换成 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Channel"},{"Type":"NodeText","Data":"​，这里使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"NioServerSocketChannel"},{"Type":"NodeText","Data":"​"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"childHandler"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"处理已接收的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Channel"},{"Type":"NodeText","Data":"​ 的处理器"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"option"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Channel"},{"Type":"NodeText","Data":"​ 实现的配置参数，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"TCP/IP"},{"Type":"NodeText","Data":"​ 服务器可实现 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"SO_KEEPALIVE"},{"Type":"NodeText","Data":"​ 等"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"bind"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"绑定监听端口并阻塞等待，返回的是一个 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Future"},{"Type":"NodeText","Data":"​，表示一个（可能）还未发生的 IO 事件，Netty 的所有操作都是异步的"}]}]}]},{"ID":"20240311174305-3b04e6i","Type":"NodeParagraph","Properties":{"id":"20240311174305-3b04e6i","updated":"20240311174705"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"closeFuture()"},{"Type":"NodeText","Data":"​ 方法可以关闭一个连接，这是一个异步事件"}]},{"ID":"20240311174329-yeirzng","Type":"NodeParagraph","Properties":{"id":"20240311174329-yeirzng","updated":"20240311174712"},"Children":[{"Type":"NodeText","Data":"异步事件的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"sync()"},{"Type":"NodeText","Data":"​ 方法可以转换成同步事件，阻塞到事件完成"}]},{"Type":"NodeSuperBlockCloseMarker"}]},{"Type":"NodeSuperBlockCloseMarker"}]},{"ID":"20240311174531-q58fic7","Type":"NodeParagraph","Properties":{"id":"20240311174531-q58fic7","updated":"20240311175811"},"Children":[{"Type":"NodeText","Data":"实例中创建了两个 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"EventLoopGroup"},{"Type":"NodeText","Data":"​ 循环器"}]},{"ID":"20240311173959-8mfzmnx","Type":"NodeList","ListData":{},"Properties":{"id":"20240311173959-8mfzmnx","updated":"20240311175811"},"Children":[{"ID":"20240311174000-iw8t9j5","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240311174000-iw8t9j5","updated":"20240311174000"},"Children":[{"ID":"20240311174000-dnn63mu","Type":"NodeParagraph","Properties":{"id":"20240311174000-dnn63mu","updated":"20240311174006"},"Children":[{"Type":"NodeText","Data":"boss：接收进来的连接，会将连接传递给 worker"}]}]},{"ID":"20240311174010-xeyaf0p","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240311174010-xeyaf0p"},"Children":[{"ID":"20240311174010-rm4i7wi","Type":"NodeParagraph","Properties":{"id":"20240311174010-rm4i7wi","updated":"20240311174017"},"Children":[{"Type":"NodeText","Data":"worker：处理要发送出去的数据"}]}]}]},{"ID":"20240311174608-jdbau7i","Type":"NodeParagraph","Properties":{"id":"20240311174608-jdbau7i","updated":"20240311175811"},"Children":[{"Type":"NodeText","Data":"注册了一个 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ChannelInitializer"},{"Type":"NodeText","Data":"​ 类型的处理器，初始化了一个处理管道，使一个 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Channel"},{"Type":"NodeText","Data":"​ 依次经过多个处理器。管线中只有一个 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"DiscardServerHandler"},{"Type":"NodeText","Data":"​ 自定义的处理器，仅丢弃数据"}]},{"ID":"20240311173832-6w9urkq","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240311173832-6w9urkq","updated":"20240311175811"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"class DiscardServerHandler extends ChannelInboundHandlerAdapter {\n\n    @Override\n    public void channelRead(ChannelHandlerContext ctx, Object msg) {\n        ReferenceCountUtil.release(msg);\n    }\n\n    @Override\n    public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) {\n        cause.printStackTrace();\n        ctx.close();\n    }\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]}