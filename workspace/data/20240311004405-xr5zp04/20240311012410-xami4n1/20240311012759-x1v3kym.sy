{"ID":"20240311012759-x1v3kym","Spec":"1","Type":"NodeDocument","Properties":{"icon":"1f923","id":"20240311012759-x1v3kym","title":"宏定义","updated":"20240311012815"},"Children":[{"ID":"20240311012815-v8mbvme","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240311012815-v8mbvme","updated":"20240311012815"},"Children":[{"Type":"NodeText","Data":"宏定义中的空格"}]},{"ID":"20240311012815-9gxebbo","Type":"NodeParagraph","Properties":{"id":"20240311012815-9gxebbo","updated":"20240311012816"},"Children":[{"Type":"NodeText","Data":"在创建宏时，宏名称与参数之间不能存在空格"}]},{"ID":"20240311012815-cktzm4w","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240311012815-cktzm4w","updated":"20240311012816"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"#define f (x) ((x)-1)\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240311012815-jbbhj3x","Type":"NodeParagraph","Properties":{"id":"20240311012815-jbbhj3x","updated":"20240311012816"},"Children":[{"Type":"NodeText","Data":"上面的宏中，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"f"},{"Type":"NodeText","Data":"​ 与 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"(x)"},{"Type":"NodeText","Data":"​ 之间多了一个空格，因此相当于："}]},{"ID":"20240311012815-jicuvs2","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240311012815-jicuvs2","updated":"20240311012816"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"#define f (x)((x)-1)\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240311012815-k9zniqe","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240311012815-k9zniqe","updated":"20240311012815"},"Children":[{"Type":"NodeText","Data":"宏不是函数"}]},{"ID":"20240311012815-stu628o","Type":"NodeParagraph","Properties":{"id":"20240311012815-stu628o","updated":"20240311012816"},"Children":[{"Type":"NodeText","Data":"宏只是查找替换，不是函数，因此可能出一些问题："}]},{"ID":"20240311012815-thcpod7","Type":"NodeList","ListData":{},"Properties":{"id":"20240311012815-thcpod7","updated":"20240311012816"},"Children":[{"ID":"20240311012815-onsqr6d","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240311012815-onsqr6d","updated":"20240311012815"},"Children":[{"ID":"20240311012815-7u0wnrt","Type":"NodeParagraph","Properties":{"id":"20240311012815-7u0wnrt","updated":"20240311012815"},"Children":[{"Type":"NodeText","Data":"优先级问题"}]}]}]},{"ID":"20240311012815-waxhp55","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240311012815-waxhp55","updated":"20240311012816"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"#define abs(x) x\u003e0?x:-x\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240311012815-sem9g5m","Type":"NodeParagraph","Properties":{"id":"20240311012815-sem9g5m","updated":"20240311012816"},"Children":[{"Type":"NodeText","Data":"当调用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"abs(a-b)"},{"Type":"NodeText","Data":"​ 时，被替换为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"a-b\u0026gt;0?a-b:-a-b"},{"Type":"NodeText","Data":"​，明显在 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"-a-b"},{"Type":"NodeText","Data":"​ 实际应该为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"-(a-b)"},{"Type":"NodeText","Data":"​。因此修改为："}]},{"ID":"20240311012815-wwbfzgi","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240311012815-wwbfzgi","updated":"20240311012816"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"#define abs(x) (x)\u003e0?(x):-(x)\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240311012815-4ckk35j","Type":"NodeParagraph","Properties":{"id":"20240311012815-4ckk35j","updated":"20240311012816"},"Children":[{"Type":"NodeText","Data":"上面的宏定义还有问题，即与外部其他内容的优先级问题，如 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"a-abs(a-b)"},{"Type":"NodeText","Data":"​ 展开为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"a-a-b\u0026gt;0?a-b:-a-b"},{"Type":"NodeText","Data":"​。因此修改为："}]},{"ID":"20240311012815-li2tfon","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240311012815-li2tfon","updated":"20240311012816"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"#define abs(x) ((x)\u003e0?(x):-(x))\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240311012815-1ermx5i","Type":"NodeList","ListData":{},"Properties":{"id":"20240311012815-1ermx5i","updated":"20240311012816"},"Children":[{"ID":"20240311012815-4zdq2a3","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240311012815-4zdq2a3","updated":"20240311012815"},"Children":[{"ID":"20240311012815-nxpckgg","Type":"NodeParagraph","Properties":{"id":"20240311012815-nxpckgg","updated":"20240311012815"},"Children":[{"Type":"NodeText","Data":"副作用问题"}]}]}]},{"ID":"20240311012815-itjq6mn","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240311012815-itjq6mn","updated":"20240311012816"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"#define max(a,b) ((a)\u003e(b)?(a):(b))\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240311012815-mg6hyds","Type":"NodeParagraph","Properties":{"id":"20240311012815-mg6hyds","updated":"20240311012816"},"Children":[{"Type":"NodeText","Data":"在下面的代码中："}]},{"ID":"20240311012815-iy0aj02","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240311012815-iy0aj02","updated":"20240311012816"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"biggest = x[0];\nint i = 1;\nwhile(i \u003c n) {\n    biggest = max(biggest, x[i++]);\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240311012815-3yjnv2y","Type":"NodeParagraph","Properties":{"id":"20240311012815-3yjnv2y","updated":"20240311012816"},"Children":[{"Type":"NodeText","Data":"展开为"}]},{"ID":"20240311012815-gub3gf2","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240311012815-gub3gf2","updated":"20240311012816"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"biggest = x[0];\nint i = 1;\nwhile(i \u003c n) {\n    biggest = ((biggest)\u003e(x[i++])?(biggest):(x[i++]));\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240311012815-c7jc3fu","Type":"NodeParagraph","Properties":{"id":"20240311012815-c7jc3fu","updated":"20240311012816"},"Children":[{"Type":"NodeText","Data":"可见，在某些分支中，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"i++"},{"Type":"NodeText","Data":"​ 被执行了两次。"}]},{"ID":"20240311012815-6nepeu5","Type":"NodeList","ListData":{},"Properties":{"id":"20240311012815-6nepeu5","updated":"20240311012816"},"Children":[{"ID":"20240311012815-yct4wmg","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240311012815-yct4wmg","updated":"20240311012815"},"Children":[{"ID":"20240311012815-2js2rzo","Type":"NodeParagraph","Properties":{"id":"20240311012815-2js2rzo","updated":"20240311012815"},"Children":[{"Type":"NodeText","Data":"当宏非常复杂或嵌套使用时，可能展开为一个很长的语句"}]}]}]},{"ID":"20240311012815-btosgwe","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240311012815-btosgwe","updated":"20240311012816"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"// ((a)\u003e(((b)\u003e(((c)\u003e(d)?(c):(d)))?(b):(((c)\u003e(d)?(c):(d))))?(a):(((b)\u003e(((c)\u003e(d)?(c):(d)))?(b):(((c)?(d)?(c):(d))))))\nmax(a, max(b, max(c, d)));\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240311012815-sguccsm","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240311012815-sguccsm","updated":"20240311012815"},"Children":[{"Type":"NodeText","Data":"宏不是语句"}]},{"ID":"20240311012815-9snfdzr","Type":"NodeParagraph","Properties":{"id":"20240311012815-9snfdzr","updated":"20240311012816"},"Children":[{"Type":"NodeText","Data":"假设我们要模拟 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"assert"},{"Type":"NodeText","Data":"​ 创建一个宏定义："}]},{"ID":"20240311012815-ka57eai","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240311012815-ka57eai","updated":"20240311012816"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"#define assert(e) if(!e) assert_error(__FILE__.__LINE__)\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240311012815-gd7n4ql","Type":"NodeParagraph","Properties":{"id":"20240311012815-gd7n4ql","updated":"20240311012816"},"Children":[{"Type":"NodeText","Data":"但当使用在 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"if"},{"Type":"NodeText","Data":"​ 语句中时："}]},{"ID":"20240311012815-hrmt5uq","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240311012815-hrmt5uq","updated":"20240311012816"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"if (x \u003e 0 \u0026\u0026 y \u003e 0)\n    assert(x \u003e y);\nelse \n    assert(y \u003e x);\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240311012815-hn3iusb","Type":"NodeParagraph","Properties":{"id":"20240311012815-hn3iusb","updated":"20240311012816"},"Children":[{"Type":"NodeText","Data":"替换后为："}]},{"ID":"20240311012815-byqe9ib","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240311012815-byqe9ib","updated":"20240311012816"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"if (x \u003e 0 \u0026\u0026 y \u003e 0)\n    if (!x \u003e y) assert_error(\"???.c\", 99);\nelse\n    if (!y \u003e x) assert_error(\"???.c\", 99);\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240311012815-usonk89","Type":"NodeParagraph","Properties":{"id":"20240311012815-usonk89","updated":"20240311012816"},"Children":[{"Type":"NodeText","Data":"重新缩进一下，即可看到我们改变了运行逻辑！"}]},{"ID":"20240311012815-cu8vo99","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240311012815-cu8vo99","updated":"20240311012816"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"if (x \u003e 0 \u0026\u0026 y \u003e 0)\n    if (!x \u003e y)\n        assert_error(\"???.c\", 99);\n    else if (!y \u003e x)\n        assert_error(\"???.c\", 99);\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240311012815-7w8u66t","Type":"NodeParagraph","Properties":{"id":"20240311012815-7w8u66t","updated":"20240311012816"},"Children":[{"Type":"NodeText","Data":"事实上其实现方式为："}]},{"ID":"20240311012815-yfvv65z","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240311012815-yfvv65z","updated":"20240311012816"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"#define assert(e) ((void)((e)||assert_error(__FILE__.__LINE__)))\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240311012815-hxjr638","Type":"NodeParagraph","Properties":{"id":"20240311012815-hxjr638","updated":"20240311012816"},"Children":[{"Type":"NodeText","Data":"即使之变成一条表达式"}]},{"ID":"20240311012815-teka4ep","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240311012815-teka4ep","updated":"20240311012815"},"Children":[{"Type":"NodeText","Data":"宏不是类型定义"}]},{"ID":"20240311012815-zuw7emc","Type":"NodeParagraph","Properties":{"id":"20240311012815-zuw7emc","updated":"20240311012816"},"Children":[{"Type":"NodeText","Data":"宏可以用于为类型起别名"}]},{"ID":"20240311012815-nlvmwcf","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240311012815-nlvmwcf","updated":"20240311012816"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"#define FOOTYPE struct foo\nFOOTYPE a, b, c;\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240311012815-bzwe7ua","Type":"NodeParagraph","Properties":{"id":"20240311012815-bzwe7ua","updated":"20240311012816"},"Children":[{"Type":"NodeText","Data":"但当我们为指针起别名时，"}]},{"ID":"20240311012815-e6zmnx2","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240311012815-e6zmnx2","updated":"20240311012816"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"#define T struct foo *\nT a, b;\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240311012815-sovkzni","Type":"NodeParagraph","Properties":{"id":"20240311012815-sovkzni","updated":"20240311012816"},"Children":[{"Type":"NodeText","Data":"其展开为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"struct foo *a, b"},{"Type":"NodeText","Data":"​，可见 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"b"},{"Type":"NodeText","Data":"​ 并不是指针。"}]},{"ID":"20240311012815-r2d1lvc","Type":"NodeParagraph","Properties":{"id":"20240311012815-r2d1lvc","updated":"20240311012816"},"Children":[{"Type":"NodeText","Data":"这种情况应当使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"typedef"},{"Type":"NodeText","Data":"​ 替代 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"#define"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240311012815-5ja2l7g","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240311012815-5ja2l7g","updated":"20240311012816"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"typedef struct foo *T;\nT a, b;\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]}