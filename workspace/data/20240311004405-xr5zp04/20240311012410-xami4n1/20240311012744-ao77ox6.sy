{"ID":"20240311012744-ao77ox6","Spec":"1","Type":"NodeDocument","Properties":{"icon":"1f923","id":"20240311012744-ao77ox6","title":"库函数","updated":"20240311012751"},"Children":[{"ID":"20240311012751-mya6jfg","Type":"NodeParagraph","Properties":{"id":"20240311012751-mya6jfg","updated":"20240311012751"},"Children":[{"Type":"NodeText","Data":"多数情况下库函数不会有什么问题，但某些情况下库函数表现出的行为往往有悖于其本意。"}]},{"ID":"20240311012751-8up7ocj","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240311012751-8up7ocj","updated":"20240311012751"},"Children":[{"Type":"NodeText","Data":"getchar"}]},{"ID":"20240311012751-y2jfv60","Type":"NodeList","ListData":{},"Properties":{"id":"20240311012751-y2jfv60","updated":"20240311012752"},"Children":[{"ID":"20240311012751-btj5uk1","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240311012751-btj5uk1","updated":"20240311012751"},"Children":[{"ID":"20240311012751-itmymer","Type":"NodeParagraph","Properties":{"id":"20240311012751-itmymer","updated":"20240311012751"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"getchar"},{"Type":"NodeText","Data":"​ 多数情况下应返回一个 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"char"},{"Type":"NodeText","Data":"​，但若没有输入时返回 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"EOF"},{"Type":"NodeText","Data":"​ 为一个整形"}]}]}]},{"ID":"20240311012751-j791h6r","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240311012751-j791h6r","updated":"20240311012751"},"Children":[{"Type":"NodeText","Data":"更新顺序文件"}]},{"ID":"20240311012751-i4gvhrk","Type":"NodeList","ListData":{},"Properties":{"id":"20240311012751-i4gvhrk","updated":"20240311012752"},"Children":[{"ID":"20240311012751-ed88g34","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240311012751-ed88g34","updated":"20240311012751"},"Children":[{"ID":"20240311012751-xm5q3c7","Type":"NodeParagraph","Properties":{"id":"20240311012751-xm5q3c7","updated":"20240311012751"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"fwrite"},{"Type":"NodeText","Data":"​ 后如果需要直接读取，应当插入一个 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"fseek"},{"Type":"NodeText","Data":"​"}]}]}]},{"ID":"20240311012751-bdhyayr","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240311012751-bdhyayr","updated":"20240311012752"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"struct record rec;\nFILE *fp;*\nfwrite(msg, ((char*) \u0026rec, sizeof(rec), 1, fp);\n// fwrite -\u003e fread 之间必须插入一个 fseek 用于改变文件状态\nfseek(fp, 0L, 1);\nfread(...);\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240311012751-mwj8fn2","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240311012751-mwj8fn2","updated":"20240311012751"},"Children":[{"Type":"NodeText","Data":"缓冲区"}]},{"ID":"20240311012751-gga0dbs","Type":"NodeParagraph","Properties":{"id":"20240311012751-gga0dbs","updated":"20240311012752"},"Children":[{"Type":"NodeText","Data":"在使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"setbuf"},{"Type":"NodeText","Data":"​ 设置流缓冲区时，不能使用局部的缓冲区数组"}]},{"ID":"20240311012751-9og178l","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240311012751-9og178l","updated":"20240311012752"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"int main() {\n    char buf[BUFSIZ];\n    setbuf(stdout, buf);\n\n    return 0;\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240311012751-umlzs2a","Type":"NodeParagraph","Properties":{"id":"20240311012751-umlzs2a","updated":"20240311012752"},"Children":[{"Type":"NodeText","Data":"以上程序是错误的。在 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"main"},{"Type":"NodeText","Data":"​ 函数执行完成后，C 会最后一次清空缓冲区，此时已经在 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"buf"},{"Type":"NodeText","Data":"​ 生存周期之外。"}]},{"ID":"20240311012751-9kx4sim","Type":"NodeParagraph","Properties":{"id":"20240311012751-9kx4sim","updated":"20240311012752"},"Children":[{"Type":"NodeText","Data":"正确做法是使用静态成员变量，或者堆内存"}]},{"ID":"20240311012751-tmxmdgi","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240311012751-tmxmdgi","updated":"20240311012752"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"int main() {\n    // 静态成员\n    static char buf[BUFSIZ];\n    setbuf(stdout, buf);\n    // 堆内存\n    setbuf(stdout, malloc(BUFSIZ));\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240311012751-lad1lb8","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240311012751-lad1lb8","updated":"20240311012751"},"Children":[{"Type":"NodeText","Data":"errno"}]},{"ID":"20240311012751-a9b5t5d","Type":"NodeParagraph","Properties":{"id":"20240311012751-a9b5t5d","updated":"20240311012752"},"Children":[{"Type":"NodeText","Data":"系统库失败时会将异常信息通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"errno"},{"Type":"NodeText","Data":"​ 传递出。但标准库并未强制要求在没有失败时库函数一定要设置 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"errno"},{"Type":"NodeText","Data":"​ 为 0，在调用成功时也不强制要求设置为 0。因此，我们应先检测作为错误指示的返回值，确定程序失败。"}]},{"ID":"20240311012751-19v1m3o","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240311012751-19v1m3o","updated":"20240311012751"},"Children":[{"Type":"NodeText","Data":"signal"}]},{"ID":"20240311012751-dhp4011","Type":"NodeParagraph","Properties":{"id":"20240311012751-dhp4011","updated":"20240311012752"},"Children":[{"Type":"NodeText","Data":"在使用信号量处理中断时，需要时刻注意："}]},{"ID":"20240311012751-puqsqdh","Type":"NodeList","ListData":{},"Properties":{"id":"20240311012751-puqsqdh","updated":"20240311012752"},"Children":[{"ID":"20240311012751-ptam3pk","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240311012751-ptam3pk","updated":"20240311012751"},"Children":[{"ID":"20240311012751-qphff7j","Type":"NodeParagraph","Properties":{"id":"20240311012751-qphff7j","updated":"20240311012751"},"Children":[{"Type":"NodeText","Data":"谨慎或禁止使用库函数，因为中断可能在一些复杂库函数中触发（如 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"malloc"},{"Type":"NodeText","Data":"​）"}]}]},{"ID":"20240311012751-d9dt3iv","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240311012751-d9dt3iv","updated":"20240311012751"},"Children":[{"ID":"20240311012751-ill461d","Type":"NodeParagraph","Properties":{"id":"20240311012751-ill461d","updated":"20240311012751"},"Children":[{"Type":"NodeText","Data":"在处理一些错误时，如算术运算错误，我们不可能在中断中修正操作数，中断返回后仍会触发错误，正确的办法是使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"longjmp"},{"Type":"NodeText","Data":"​ 或 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"exit"},{"Type":"NodeText","Data":"​ 立刻退出程序"}]}]}]}]}