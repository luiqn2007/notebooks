{"ID":"20240311012648-tkxsht3","Spec":"1","Type":"NodeDocument","Properties":{"icon":"1f923","id":"20240311012648-tkxsht3","title":"语义陷阱","updated":"20240311012658"},"Children":[{"ID":"20240311012658-z5coyyq","Type":"NodeParagraph","Properties":{"id":"20240311012658-z5coyyq","updated":"20240311012658"},"Children":[{"Type":"NodeText","Data":"该章节讨论在语法、语义上均正确的情况下，仍有歧义或与本意不同的情况。"}]},{"ID":"20240311012658-sh8db5i","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240311012658-sh8db5i","updated":"20240311012658"},"Children":[{"Type":"NodeText","Data":"数组"}]},{"ID":"20240311012658-fuhvlvc","Type":"NodeParagraph","Properties":{"id":"20240311012658-fuhvlvc","updated":"20240311012659"},"Children":[{"Type":"NodeText","Data":"C 语言中数组的特点："}]},{"ID":"20240311012658-5xo54k2","Type":"NodeList","ListData":{},"Properties":{"id":"20240311012658-5xo54k2","updated":"20240311012659"},"Children":[{"ID":"20240311012658-yept04v","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240311012658-yept04v","updated":"20240311012658"},"Children":[{"ID":"20240311012658-ii02omb","Type":"NodeParagraph","Properties":{"id":"20240311012658-ii02omb","updated":"20240311012658"},"Children":[{"Type":"NodeText","Data":"C 语言"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"只有"},{"Type":"NodeText","Data":"一维数组，且（C99前）数组长度必须在编译期确定。多维数组是 "},{"Type":"NodeTextMark","TextMarkType":"em","TextMarkTextContent":"数组的数组"},{"Type":"NodeText","Data":" 模拟出来的。"}]}]}]},{"ID":"20240311012658-hokucoz","Type":"NodeParagraph","Properties":{"id":"20240311012658-hokucoz","updated":"20240311012659"},"Children":[{"Type":"NodeText","Data":"例："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"int calendar[12][31]"},{"Type":"NodeText","Data":"​ 是一个拥有 12 个元素的数组，每个元素是 31 个整形的数组"}]},{"ID":"20240311012658-fx4p1h9","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240311012658-fx4p1h9","updated":"20240311012659"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"int calendar[12][31];\n// 1488 = 12 * 31 * sizeof(int)\nsizeof calendar;\n// 124 = 31 * sizeof(int)\nsizeof calendar[0];\n\nint *p;\n// 编译错误\np = calendar;\n\nint (*pp)[31];\n// ok\npp = calendar;\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240311012658-s6zzc2f","Type":"NodeList","ListData":{},"Properties":{"id":"20240311012658-s6zzc2f","updated":"20240311012659"},"Children":[{"ID":"20240311012658-n65te70","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240311012658-n65te70","updated":"20240311012658"},"Children":[{"ID":"20240311012658-bkpvd3m","Type":"NodeParagraph","Properties":{"id":"20240311012658-bkpvd3m","updated":"20240311012658"},"Children":[{"Type":"NodeText","Data":"任何一个对数组的操作都是通过"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"指针"},{"Type":"NodeText","Data":"完成的，任何一个数组下标运算都等同于对指针的运算。"}]}]}]},{"ID":"20240311012658-g1nj9t5","Type":"NodeParagraph","Properties":{"id":"20240311012658-g1nj9t5","updated":"20240311012659"},"Children":[{"Type":"NodeText","Data":"陷阱："}]},{"ID":"20240311012658-ee3lvz8","Type":"NodeList","ListData":{},"Properties":{"id":"20240311012658-ee3lvz8","updated":"20240311012659"},"Children":[{"ID":"20240311012658-12b0az1","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240311012658-12b0az1","updated":"20240311012658"},"Children":[{"ID":"20240311012658-orz4gob","Type":"NodeParagraph","Properties":{"id":"20240311012658-orz4gob","updated":"20240311012658"},"Children":[{"Type":"NodeText","Data":"一个指针与整形进行运算，与指针地址值加上同一个整形的值不同，指针运算的一个单位是原始类型的长度"}]}]}]},{"ID":"20240311012658-vzql80t","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240311012658-vzql80t","updated":"20240311012659"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"int k, *p = \u0026k;\n\nunsigned long long v1 = (unsigned long long) p + sizeof(int);\nunsigned long long v2 = (unsigned long long) (p + 1);\nint dv = (int *) v1 - p;\n\n// 1 1\nprintf(\"%d %d\", v2 == v1, dv);\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240311012658-nu4yluv","Type":"NodeList","ListData":{},"Properties":{"id":"20240311012658-nu4yluv","updated":"20240311012659"},"Children":[{"ID":"20240311012658-7te4aw7","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240311012658-7te4aw7","updated":"20240311012658"},"Children":[{"ID":"20240311012658-ku82xoe","Type":"NodeParagraph","Properties":{"id":"20240311012658-ku82xoe","updated":"20240311012658"},"Children":[{"Type":"NodeText","Data":"数组为函数传参时，会退化成指针，即抹去数组长度；即函数形参列表中，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"[]"},{"Type":"NodeText","Data":"​ 与 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"*"},{"Type":"NodeText","Data":"​ 等价，只是想表达的侧重点不同"}]}]},{"ID":"20240311012658-r7xeg78","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240311012658-r7xeg78","updated":"20240311012658"},"Children":[{"ID":"20240311012658-6mgt8k5","Type":"NodeParagraph","Properties":{"id":"20240311012658-6mgt8k5","updated":"20240311012658"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"sizeof"},{"Type":"NodeText","Data":"​ 如果对一个数组使用，取得的是整个数组占用的内存空间；如果对一个指针使用，则返回一个指针变量的长度"}]}]},{"ID":"20240311012658-apube48","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240311012658-apube48","updated":"20240311012658"},"Children":[{"ID":"20240311012658-tei8l2q","Type":"NodeParagraph","Properties":{"id":"20240311012658-tei8l2q","updated":"20240311012658"},"Children":[{"Type":"NodeText","Data":"由于数组下标运算实质是指针运算，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"i+a"},{"Type":"NodeText","Data":"​ 与 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"a+i"},{"Type":"NodeText","Data":"​ 等效，因此 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"a[i]"},{"Type":"NodeText","Data":"​ 与 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"i[a]"},{"Type":"NodeText","Data":"​ 等效，即一个 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"下标[数组]"},{"Type":"NodeText","Data":"​ 与 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"数组[下标]"},{"Type":"NodeText","Data":"​ 等效"}]}]},{"ID":"20240311012658-5ag9u9w","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240311012658-5ag9u9w","updated":"20240311012658"},"Children":[{"ID":"20240311012659-644i2x3","Type":"NodeParagraph","Properties":{"id":"20240311012659-644i2x3","updated":"20240311012659"},"Children":[{"Type":"NodeText","Data":"注意 C 字符串是一个指针，空指针并非空字符串"}]}]},{"ID":"20240311012658-l3rk3jg","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240311012658-l3rk3jg","updated":"20240311012658"},"Children":[{"ID":"20240311012659-c5spaf6","Type":"NodeParagraph","Properties":{"id":"20240311012659-c5spaf6","updated":"20240311012659"},"Children":[{"Type":"NodeText","Data":"C 字符串以 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\\0"},{"Type":"NodeText","Data":"​ 结尾，因此 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"strlen"},{"Type":"NodeText","Data":"​ 算出的长度比占用的空间少 1 个 char"}]}]},{"ID":"20240311012658-1bdegl0","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240311012658-1bdegl0","updated":"20240311012658"},"Children":[{"ID":"20240311012659-lde882v","Type":"NodeParagraph","Properties":{"id":"20240311012659-lde882v","updated":"20240311012659"},"Children":[{"Type":"NodeText","Data":"数组长度 = 上界 - 下界，下界永远不可能小于上界"}]},{"ID":"20240311012659-hngt9n8","Type":"NodeList","ListData":{},"Properties":{"id":"20240311012659-hngt9n8","updated":"20240311012659"},"Children":[{"ID":"20240311012658-o17cweg","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240311012658-o17cweg","updated":"20240311012658"},"Children":[{"ID":"20240311012659-43hoaw3","Type":"NodeParagraph","Properties":{"id":"20240311012659-43hoaw3","updated":"20240311012659"},"Children":[{"Type":"NodeText","Data":"不对称边界：假设两个指针（下标）分别代表数组的开始与结束，则第一个指针指向第一个元素，第二个指针指向最后一个元素的下一个元素"}]}]},{"ID":"20240311012658-lm8f61l","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240311012658-lm8f61l","updated":"20240311012658"},"Children":[{"ID":"20240311012659-zradllk","Type":"NodeParagraph","Properties":{"id":"20240311012659-zradllk","updated":"20240311012659"},"Children":[{"Type":"NodeText","Data":"允许获取数组最后一个元素的下一个元素的地址（用于比较），但不允许访问其值"}]}]}]}]}]},{"ID":"20240311012659-h58z7hf","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240311012659-h58z7hf","updated":"20240311012659"},"Children":[{"Type":"NodeText","Data":"求值顺序"}]},{"ID":"20240311012659-g8wo4ys","Type":"NodeList","ListData":{},"Properties":{"id":"20240311012659-g8wo4ys","updated":"20240311012659"},"Children":[{"ID":"20240311012658-yktt7si","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240311012658-yktt7si","updated":"20240311012658"},"Children":[{"ID":"20240311012659-je1x1yc","Type":"NodeParagraph","Properties":{"id":"20240311012659-je1x1yc","updated":"20240311012659"},"Children":[{"Type":"NodeText","Data":"存在中断的运算符："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026amp;\u0026amp;"},{"Type":"NodeText","Data":"​，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"||"},{"Type":"NodeText","Data":"​，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"?:"},{"Type":"NodeText","Data":"​"}]}]}]},{"ID":"20240311012659-j0gn2e7","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240311012659-j0gn2e7","updated":"20240311012659"},"Children":[{"Type":"NodeText","Data":"整数溢出"}]},{"ID":"20240311012659-mk0w5f4","Type":"NodeParagraph","Properties":{"id":"20240311012659-mk0w5f4","updated":"20240311012659"},"Children":[{"Type":"NodeText","Data":"当两个数字都是有符号整形时，可能发出溢出。使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"a + b \u0026lt; 0"},{"Type":"NodeText","Data":"​ 校验是不准确的。"}]},{"ID":"20240311012659-ph3t2by","Type":"NodeParagraph","Properties":{"id":"20240311012659-ph3t2by","updated":"20240311012659"},"Children":[{"Type":"NodeText","Data":"正确校验整形溢出的方法有："}]},{"ID":"20240311012659-znvc878","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240311012659-znvc878","updated":"20240311012659"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"// 1 将无符号转换为有符号，与 INT_MAX 比较\nif ((unsigned) a + (unsigned) b \u003e INT_MAX) { /* 溢出 */ }\n\n// 2 使用减法\nif (a \u003e INT_MAX - b) { /* 溢出 */ }\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240311012659-f28y64v","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240311012659-f28y64v","updated":"20240311012659"},"Children":[{"Type":"NodeText","Data":"main 返回值"}]},{"ID":"20240311012659-ryh821t","Type":"NodeList","ListData":{},"Properties":{"id":"20240311012659-ryh821t","updated":"20240311012659"},"Children":[{"ID":"20240311012658-4lqv686","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240311012658-4lqv686","updated":"20240311012658"},"Children":[{"ID":"20240311012659-aarl1aw","Type":"NodeParagraph","Properties":{"id":"20240311012659-aarl1aw","updated":"20240311012659"},"Children":[{"Type":"NodeText","Data":"返回 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"int"},{"Type":"NodeText","Data":"​ 的函数，如果省略返回值，则该函数返回值具体是什么是未定义的"}]}]},{"ID":"20240311012658-j7tl3l9","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240311012658-j7tl3l9","updated":"20240311012658"},"Children":[{"ID":"20240311012659-s969ov5","Type":"NodeParagraph","Properties":{"id":"20240311012659-s969ov5","updated":"20240311012659"},"Children":[{"Type":"NodeText","Data":"函数返回值类型可省略，默认为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"int"},{"Type":"NodeText","Data":"​"}]}]}]},{"ID":"20240311012659-s57n132","Type":"NodeParagraph","Properties":{"id":"20240311012659-s57n132","updated":"20240311012659"},"Children":[{"Type":"NodeText","Data":"C语言 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"main"},{"Type":"NodeText","Data":"​ 函数返回值是有意义的，表示程序是否正常执行。因此，应当使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"return 0;"},{"Type":"NodeText","Data":"​ 而不是省略返回值。"}]}]}