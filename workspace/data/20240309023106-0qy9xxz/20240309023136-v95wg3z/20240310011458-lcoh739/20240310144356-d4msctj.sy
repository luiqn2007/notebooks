{"ID":"20240310144356-d4msctj","Spec":"1","Type":"NodeDocument","Properties":{"icon":"2620-fe0f","id":"20240310144356-d4msctj","title":"动态内存分配","updated":"20240311105821"},"Children":[{"ID":"20240310144407-l9wgsj9","Type":"NodeParagraph","Properties":{"id":"20240310144407-l9wgsj9","updated":"20240310235147"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"new"},{"Type":"NodeText","Data":"​ 用于在堆上申请内存的关键字和运算符，并返回该内存块的首地址指针。可以申请一个任意类型的值或一个数组，返回对应类型的指针。"}]},{"ID":"20240310144407-7tfi2p9","Type":"NodeParagraph","Properties":{"id":"20240310144407-7tfi2p9","style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);","updated":"20240310144426"},"Children":[{"Type":"NodeText","Data":"堆，又称空闲存储器，计算机中分配给程序的未使用的内存"}]},{"ID":"20240310144407-h5i3tds","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240310144407-h5i3tds","updated":"20240310144407"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yysr"},{"Type":"NodeCodeBlockCode","Data":"int *a = new int;\n\nint **b = new int[10];\n\nint count = 20;\nint **c = new int[count];\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240310144407-3yg1yo9","Type":"NodeParagraph","Properties":{"id":"20240310144407-3yg1yo9","updated":"20240310144407"},"Children":[{"Type":"NodeText","Data":"如果内存空间不足以容纳申请的值，则会返回 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"nullptr"},{"Type":"NodeText","Data":"​​。但不需要刻意去检查，如果内存不足程序会直接抛出异常。"}]},{"ID":"20240310144407-cfo1iut","Type":"NodeParagraph","Properties":{"id":"20240310144407-cfo1iut","style":"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);","updated":"20240310144436"},"Children":[{"Type":"NodeText","Data":"使用 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);"},"TextMarkType":"code","TextMarkTextContent":"new"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);\"}"},{"Type":"NodeText","Data":"​ 创建的指针需要使用 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);"},"TextMarkType":"code","TextMarkTextContent":"delete"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);\"}"},{"Type":"NodeText","Data":"​ 释放，以免造成内存溢出"}]},{"ID":"20240310144407-5cwkdrm","Type":"NodeParagraph","Properties":{"id":"20240310144407-5cwkdrm","updated":"20240310144407"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"delete"},{"Type":"NodeText","Data":"​ 用于在堆上释放内存的关键字和运算符，可以释放使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"new"},{"Type":"NodeText","Data":"​ 申请的堆内存，但不会修改原指针的值。"}]},{"ID":"20240310144407-t38hpjv","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240310144407-t38hpjv","updated":"20240310144407"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yysr"},{"Type":"NodeCodeBlockCode","Data":"int *a = new int;\n\nint **b = new int[10];\n\nint count = 20;\nint **c = new int[count];\n\ndelete a;\ndelete [] b, c;\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240310144407-ytjnt6n","Type":"NodeParagraph","Properties":{"id":"20240310144407-ytjnt6n","updated":"20240310144407"},"Children":[{"Type":"NodeText","Data":"可以直接释放 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"nullptr"},{"Type":"NodeText","Data":"​，这时不会进行任何操作。但若被释放的指针不是 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"nullptr"},{"Type":"NodeText","Data":"​ 且对应的内存不是由 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"new"},{"Type":"NodeText","Data":"​ 申请的，或已经被释放了，则会抛出异常。"}]},{"ID":"20240310144407-9wg3xs4","Type":"NodeBlockquote","Properties":{"id":"20240310144407-9wg3xs4","updated":"20240310144506"},"Children":[{"ID":"20240310144407-68v4i2w","Type":"NodeParagraph","Properties":{"id":"20240310144407-68v4i2w","style":"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);","updated":"20240310144455"},"Children":[{"Type":"NodeText","Data":"使用 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);"},"TextMarkType":"code","TextMarkTextContent":"delete"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);\"}"},{"Type":"NodeText","Data":"​ 释放后的内存，其值是不可预测的，应当立即将指针赋值为 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);"},"TextMarkType":"code","TextMarkTextContent":"nullptr"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);\"}"},{"Type":"NodeText","Data":"​ 以免出问题。"}]},{"Type":"NodeBlockquoteMarker","Data":"\u003e"},{"ID":"20240310144407-1gzj8qr","Type":"NodeParagraph","Properties":{"id":"20240310144407-1gzj8qr","style":"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);","updated":"20240310144506"},"Children":[{"Type":"NodeText","Data":"尽量遵循 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);"},"TextMarkType":"strong","TextMarkTextContent":"谁申请谁销毁"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);\"}"},{"Type":"NodeText","Data":" 或提供 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);"},"TextMarkType":"strong","TextMarkTextContent":"足够明确"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);\"}"},{"Type":"NodeText","Data":" 的提示"}]}]},{"ID":"20240310144407-yguwu2r","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240310144407-yguwu2r","updated":"20240310144407"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yysr"},{"Type":"NodeCodeBlockCode","Data":"int *a = new int;\ndelete a;\na = nullptr;\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240310144407-sweuct1","Type":"NodeParagraph","Properties":{"id":"20240310144407-sweuct1","style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);","updated":"20240310204933"},"Children":[{"Type":"NodeText","Data":"悬垂指针：指针经 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);"},"TextMarkType":"code","TextMarkTextContent":"delete"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);\"}"},{"Type":"NodeText","Data":"​ 释放后，原地址理论上来说就无效了，再通过该地址访问数据获取的是不可预测的数据。这种指针称为悬垂指针"}]},{"ID":"20240310144407-n3cysjy","Type":"NodeParagraph","Properties":{"id":"20240310144407-n3cysjy","style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);","updated":"20240310144646"},"Children":[{"Type":"NodeText","Data":"内存泄漏：非自动内存没有释放，通常是手动 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);"},"TextMarkType":"code","TextMarkTextContent":"new"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);\"}"},{"Type":"NodeText","Data":"​ 或 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);"},"TextMarkType":"code","TextMarkTextContent":"malloc"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);\"}"},{"Type":"NodeText","Data":"​ 申请的内存没有 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);"},"TextMarkType":"code","TextMarkTextContent":"delete"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);\"}"},{"Type":"NodeText","Data":"​ 或 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);"},"TextMarkType":"code","TextMarkTextContent":"free"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);\"}"},{"Type":"NodeText","Data":"​，当该地址丢失后，指向的内存永远无法被C++释放，这种情况称为内存泄漏"}]},{"ID":"20240310144407-kyq5aiy","Type":"NodeParagraph","Properties":{"id":"20240310144407-kyq5aiy","updated":"20240310235224"},"Children":[{"Type":"NodeText","Data":"一般值，类，结构体"}]},{"ID":"20240311105821-axrtpqc","Type":"NodeParagraph","Properties":{"id":"20240311105821-axrtpqc","updated":"20240311105821"},"Children":[{"Type":"NodeText","Data":"等，直接通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"new"},{"Type":"NodeText","Data":"​ 和 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"delete"},{"Type":"NodeText","Data":"​ 即可申请和释放"}]},{"ID":"20240310144407-lfrw53f","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240310144407-lfrw53f","updated":"20240310144407"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yysr"},{"Type":"NodeCodeBlockCode","Data":"// 申请内存\ndouble *pvalue {};\npvalue = new double;\n*pvalue = 999.0;\n// 以上申请和赋值可以简化成这一句\ndouble *pvalue2 { new double { 999.0 } };\n// 释放内存\ndelete pvalue;\ndelete pvalue2;\n// 防止悬垂指针\npvalue = nullptr;\npvalue2 = nullptr;\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240310144407-ggde5wr","Type":"NodeParagraph","Properties":{"id":"20240310144407-ggde5wr","updated":"20240310205047"},"Children":[{"Type":"NodeText","Data":"申请和释放"},{"Type":"NodeTextMark","TextMarkType":"block-ref","TextMarkBlockRefID":"20240310144728-rj1rboz","TextMarkBlockRefSubtype":"s","TextMarkTextContent":"数组"},{"Type":"NodeText","Data":"使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"[]"},{"Type":"NodeText","Data":"​​"}]},{"ID":"20240310144407-zkmrq5o","Type":"NodeList","ListData":{},"Properties":{"id":"20240310144407-zkmrq5o","updated":"20240310144407"},"Children":[{"ID":"20240310144407-yvzqz7c","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240310144407-yvzqz7c","updated":"20240310144407"},"Children":[{"ID":"20240310144407-ph0bj1s","Type":"NodeParagraph","Properties":{"id":"20240310144407-ph0bj1s","updated":"20240310144407"},"Children":[{"Type":"NodeText","Data":"可在运行时决定数组长度"}]}]},{"ID":"20240310144407-b8tm9b2","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240310144407-b8tm9b2","updated":"20240310144407"},"Children":[{"ID":"20240310144407-u68hv9k","Type":"NodeParagraph","Properties":{"id":"20240310144407-u68hv9k","updated":"20240310144407"},"Children":[{"Type":"NodeText","Data":"可创建每个维度长度不同的多维数组"}]}]}]},{"ID":"20240310144407-ol4lwsw","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240310144407-ol4lwsw","updated":"20240310144407"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yysr"},{"Type":"NodeCodeBlockCode","Data":"int *pdata { new int[5] { 1, 3, 5, 7, 9 } };\ndelete [] pdata;\npdata = nullptr;\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240310205032-27owdzn","Type":"NodeParagraph","Properties":{"id":"20240310205032-27owdzn","updated":"20240310205037"},"Children":[{"Type":"NodeText","Data":"多维数组在申请时，最外层数组长度必须是明确的。而释放内存时，无论多少维，均使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"delete []"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240310205032-ycu365w","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240310205032-ycu365w","updated":"20240310205032"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yysr"},{"Type":"NodeCodeBlockCode","Data":"double (*pvalues)[5] { new double[3][5] };\ndelete [] pvalues;\npvalues = nullptr;\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]}