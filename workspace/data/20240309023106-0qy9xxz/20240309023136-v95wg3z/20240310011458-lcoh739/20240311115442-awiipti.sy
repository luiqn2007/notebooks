{"ID":"20240311115442-awiipti","Spec":"1","Type":"NodeDocument","Properties":{"icon":"2620-fe0f","id":"20240311115442-awiipti","tags":"C++11","title":"nullptr","updated":"20240311120154"},"Children":[{"ID":"20240311115459-mgxls8m","Type":"NodeParagraph","Properties":{"id":"20240311115459-mgxls8m","updated":"20240311120119"},"Children":[{"Type":"NodeText","Data":"传统 C 与 C++11 之前，表示空"},{"Type":"NodeTextMark","TextMarkType":"block-ref","TextMarkBlockRefID":"20240310011458-lcoh739","TextMarkBlockRefSubtype":"s","TextMarkTextContent":"指针"},{"Type":"NodeText","Data":"的值即 0。并且由于 C++ 类型安全，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"void*"},{"Type":"NodeText","Data":"​ 不能直接隐式转换为各类指针，因此其定义就是 0 而非 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"(void*) 0"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240311115459-no7e7sz","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240311115459-no7e7sz","updated":"20240311115459"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yysr"},{"Type":"NodeCodeBlockCode","Data":"cout \u003c\u003c typeid(NULL).name() \u003c\u003c endl; // x\ncout \u003c\u003c typeid(0LL).name() \u003c\u003c endl;  // x -- 证明 NULL 的类型就是长整型\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240311115459-fmy5oxe","Type":"NodeParagraph","Properties":{"id":"20240311115459-fmy5oxe","updated":"20240311115459"},"Children":[{"Type":"NodeText","Data":"我们可以模拟一个 NULL 宏定义："}]},{"ID":"20240311115459-n4jevrq","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240311115459-n4jevrq","updated":"20240311115459"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yysr"},{"Type":"NodeCodeBlockCode","Data":"#ifndef MY_NULL\n    #ifdef __cplusplus                    // c++\n        #define MY_NULL 0\n    #elif                                 // c\n        #define MY_NULL ((void*) 0)\n    #endif\n#endif\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240311115545-mdxrxz0","Type":"NodeSuperBlock","Properties":{"id":"20240311115545-mdxrxz0","updated":"20240311120149"},"Children":[{"Type":"NodeSuperBlockOpenMarker"},{"Type":"NodeSuperBlockLayoutMarker","Data":"row"},{"ID":"20240311115459-05lp3g6","Type":"NodeParagraph","Properties":{"id":"20240311115459-05lp3g6","updated":"20240311115935"},"Children":[{"Type":"NodeText","Data":"在 C 没问题，C 不支持函数重载。但这在 C++ 就这会引起二义性问题："}]},{"ID":"20240311115948-f1lj3mx","Type":"NodeSuperBlock","Properties":{"id":"20240311115948-f1lj3mx","updated":"20240311115459"},"Children":[{"Type":"NodeSuperBlockOpenMarker"},{"Type":"NodeSuperBlockLayoutMarker","Data":"col"},{"ID":"20240311115459-oxcphf5","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240311115459-oxcphf5","style":"width: 75%; flex: 0 0 auto;","updated":"20240311115459"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yysr"},{"Type":"NodeCodeBlockCode","Data":"void f(int v) {\n    cout \u003c\u003c \"int \" \u003c\u003c v;\n}\n\nvoid f(char* c) {\n    cout \u003c\u003c \"str \" \u003c\u003c c;\n}\n\nint main() {\n    // gcc：call of overloaded 'f(NULL)' is ambiguous\n    // 据书上说 vs 下调用的是 int 的重载\n    f(NULL);\n    return 0;\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240311115459-3dz04rn","Type":"NodeParagraph","Properties":{"id":"20240311115459-3dz04rn","updated":"20240311115949"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"NULL"},{"Type":"NodeText","Data":"​ 即 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"0LL"},{"Type":"NodeText","Data":"​ 既可以被隐式转换为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"int"},{"Type":"NodeText","Data":"​，又可以隐式转换为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"char*"},{"Type":"NodeText","Data":"​，根据重载规则产生二义性问题。不同编译器对运行结果处理不同。"}]},{"Type":"NodeSuperBlockCloseMarker"}]},{"Type":"NodeSuperBlockCloseMarker"}]},{"ID":"20240311120153-aut1fm7","Type":"NodeSuperBlock","Properties":{"id":"20240311120153-aut1fm7","updated":"20240311120154"},"Children":[{"Type":"NodeSuperBlockOpenMarker"},{"Type":"NodeSuperBlockLayoutMarker","Data":"col"},{"ID":"20240311115459-ysyun5a","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240311115459-ysyun5a","updated":"20240311120154"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yysr"},{"Type":"NodeCodeBlockCode","Data":"int main() {\n    // 编译正常，运行提示 construction from null is not valid\n    cout \u003c\u003c string(false) \u003c\u003c endl;\n    // 编译失败：no matching function for call to basic_string(bool)'\n    cout \u003c\u003c string(true) \u003c\u003c endl;\n    return 0;\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240311115459-6pclrfu","Type":"NodeParagraph","Properties":{"id":"20240311115459-6pclrfu","updated":"20240311120154"},"Children":[{"Type":"NodeText","Data":"严格上来说并非 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"NULL"},{"Type":"NodeText","Data":"​ 的问题，但本质如出一辙。"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"false"},{"Type":"NodeText","Data":"​ 先被隐式转换 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"0"},{"Type":"NodeText","Data":"​，然后转换为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"char*"},{"Type":"NodeText","Data":"​，因此可以通过编译，但指向的地址为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"NULL"},{"Type":"NodeText","Data":"​ 无效，因此运行时出错。"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"true"},{"Type":"NodeText","Data":"​ 隐式转换成数字为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"1"},{"Type":"NodeText","Data":"​，无法隐式转换为任何指针，因此过不了编译。（环境：GCC，C++98标准）"}]},{"Type":"NodeSuperBlockCloseMarker"}]},{"ID":"20240311115506-uyr1nov","Type":"NodeParagraph","Properties":{"id":"20240311115506-uyr1nov","updated":"20240311115506"},"Children":[{"Type":"NodeText","Data":"C++11 新增 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"nullptr"},{"Type":"NodeText","Data":"​ 关键字，表示一个 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"std::nullptr_t"},{"Type":"NodeText","Data":"​ 类型的纯右值表示一个空指针"}]},{"ID":"20240311115506-a04o9mg","Type":"NodeList","ListData":{},"Properties":{"id":"20240311115506-a04o9mg","updated":"20240311115506"},"Children":[{"ID":"20240311115506-zd8d0iw","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240311115506-zd8d0iw","updated":"20240311115506"},"Children":[{"ID":"20240311115506-m873gn9","Type":"NodeParagraph","Properties":{"id":"20240311115506-m873gn9","updated":"20240311115506"},"Children":[{"Type":"NodeText","Data":"禁止进行数学运算，禁止与非指针类型进行比较"}]}]},{"ID":"20240311115506-imxfdz7","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240311115506-imxfdz7","updated":"20240311115506"},"Children":[{"ID":"20240311115506-9me50ye","Type":"NodeParagraph","Properties":{"id":"20240311115506-9me50ye","updated":"20240311115506"},"Children":[{"Type":"NodeText","Data":"可以隐式转换为任何类型指针类型，无法隐式转换为任何非指针类型"}]}]},{"ID":"20240311115506-b8091cc","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240311115506-b8091cc","updated":"20240311115506"},"Children":[{"ID":"20240311115506-9f6wd4h","Type":"NodeParagraph","Properties":{"id":"20240311115506-9f6wd4h","updated":"20240311115506"},"Children":[{"Type":"NodeText","Data":"长度为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"sizeof(void*)"},{"Type":"NodeText","Data":"​"}]}]}]},{"ID":"20240311115506-d5gc9jl","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240311115506-d5gc9jl","updated":"20240311115506"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yysr"},{"Type":"NodeCodeBlockCode","Data":"using nullptr_t = decltype(nullptr);\n\nnullptr_t my_null;\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240311120041-nhkk47j","Type":"NodeSuperBlock","Properties":{"id":"20240311120041-nhkk47j","updated":"20240311120042"},"Children":[{"Type":"NodeSuperBlockOpenMarker"},{"Type":"NodeSuperBlockLayoutMarker","Data":"col"},{"ID":"20240311115506-243a1xj","Type":"NodeList","ListData":{},"Properties":{"id":"20240311115506-243a1xj","updated":"20240311120042"},"Children":[{"ID":"20240311115506-hjuht95","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240311115506-hjuht95","updated":"20240311115506"},"Children":[{"ID":"20240311115506-5iuhg1r","Type":"NodeParagraph","Properties":{"id":"20240311115506-5iuhg1r","updated":"20240311115506"},"Children":[{"Type":"NodeText","Data":"相同点："}]},{"ID":"20240311115506-ndionoi","Type":"NodeList","ListData":{},"Properties":{"id":"20240311115506-ndionoi","updated":"20240311115506"},"Children":[{"ID":"20240311115506-bsoxyan","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240311115506-bsoxyan","updated":"20240311115506"},"Children":[{"ID":"20240311115506-99kdlgp","Type":"NodeParagraph","Properties":{"id":"20240311115506-99kdlgp","updated":"20240311115506"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"my_null"},{"Type":"NodeText","Data":"​ 可以与 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"nullptr"},{"Type":"NodeText","Data":"​ 进行比较，结果为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"true"},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20240311115506-mt9z39z","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240311115506-mt9z39z","updated":"20240311115506"},"Children":[{"ID":"20240311115506-u86zdid","Type":"NodeParagraph","Properties":{"id":"20240311115506-u86zdid","updated":"20240311115506"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"my_null"},{"Type":"NodeText","Data":"​ 在指针上的性质与 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"nullptr"},{"Type":"NodeText","Data":"​ 相同"}]}]},{"ID":"20240311115506-je55awh","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240311115506-je55awh","updated":"20240311115506"},"Children":[{"ID":"20240311115506-wv5ef0j","Type":"NodeParagraph","Properties":{"id":"20240311115506-wv5ef0j","updated":"20240311115506"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"sizeof(my_null) == sizeof(void*)"},{"Type":"NodeText","Data":"​"}]}]}]}]}]},{"ID":"20240311120041-1zfknr7","Type":"NodeList","ListData":{},"Properties":{"id":"20240311120041-1zfknr7","updated":"20240311120042"},"Children":[{"ID":"20240311115506-611ilhi","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240311115506-611ilhi","updated":"20240311120042"},"Children":[{"ID":"20240311115506-pokzptr","Type":"NodeParagraph","Properties":{"id":"20240311115506-pokzptr","updated":"20240311115506"},"Children":[{"Type":"NodeText","Data":"不同点："}]},{"ID":"20240311115506-vdf218w","Type":"NodeList","ListData":{},"Properties":{"id":"20240311115506-vdf218w","updated":"20240311115506"},"Children":[{"ID":"20240311115506-dml5gq6","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240311115506-dml5gq6","updated":"20240311115506"},"Children":[{"ID":"20240311115506-0awss5n","Type":"NodeParagraph","Properties":{"id":"20240311115506-0awss5n","updated":"20240311115506"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"nullptr"},{"Type":"NodeText","Data":"​ 是关键字，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"my_null"},{"Type":"NodeText","Data":"​ 不是"}]}]},{"ID":"20240311115506-s2og21l","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240311115506-s2og21l","updated":"20240311115506"},"Children":[{"ID":"20240311115506-h08a4np","Type":"NodeParagraph","Properties":{"id":"20240311115506-h08a4np","updated":"20240311115506"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"nullptr"},{"Type":"NodeText","Data":"​ 是纯右值，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"my_null"},{"Type":"NodeText","Data":"​ 是左值，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026amp;nullptr"},{"Type":"NodeText","Data":"​ 是错误的"}]}]}]}]}]},{"Type":"NodeSuperBlockCloseMarker"}]},{"ID":"20240311120103-6i0v9yt","Type":"NodeParagraph","Properties":{"id":"20240311120103-6i0v9yt","updated":"20240311120112"},"Children":[{"Type":"NodeText","Data":"利用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"nullptr_t"},{"Type":"NodeText","Data":"​ 配合模板，我们可以对空指针进行"},{"Type":"NodeTextMark","TextMarkType":"block-ref","TextMarkBlockRefID":"20240310161115-blbt40a","TextMarkBlockRefSubtype":"s","TextMarkTextContent":"特化"},{"Type":"NodeText","Data":"处理"}]},{"ID":"20240311120103-pskbtdu","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240311120103-pskbtdu","updated":"20240311120103"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yysr"},{"Type":"NodeCodeBlockCode","Data":"template\u003ctypename T\u003e\nvoid use(T *p) {\n    cout \u003c\u003c \"p is \" \u003c\u003c typeid(*p).name() \u003c\u003c endl;\n}\n\ntemplate\u003c\u003e\nvoid use\u003cnullptr_t\u003e(nullptr_t *p) {\n    cout \u003c\u003c \"p is nullptr\" \u003c\u003c endl;\n}\n\nint main() {\n    // p is nullptr\n    use\u003cnullptr_t\u003e(nullptr);\n    // p is So\n    use(\u0026cout);\n    return 0;\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]}