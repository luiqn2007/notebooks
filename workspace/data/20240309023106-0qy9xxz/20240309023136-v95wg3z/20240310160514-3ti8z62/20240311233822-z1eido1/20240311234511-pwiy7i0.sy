{"ID":"20240311234511-pwiy7i0","Spec":"1","Type":"NodeDocument","Properties":{"icon":"2620-fe0f","id":"20240311234511-pwiy7i0","title":"requires 表达式","updated":"20240311234803"},"Children":[{"ID":"20240311234521-ckoli1j","Type":"NodeParagraph","Properties":{"id":"20240311234521-ckoli1j","updated":"20240311234741"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"requires"},{"Type":"NodeText","Data":"​ 除了引入 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"requires"},{"Type":"NodeText","Data":"​ 子句，还可以用于定义 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"requires"},{"Type":"NodeText","Data":"​ 表达式。该表达式为一个纯右值表达式，对其进行模板实参替换，若替换之后 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"requires"},{"Type":"NodeText","Data":"​ 表达式出现无效类型或违反约束条件，则表达式结果为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"false"},{"Type":"NodeText","Data":"​，"},{"Type":"NodeTextMark","TextMarkType":"block-ref","TextMarkBlockRefID":"20240311233822-z1eido1","TextMarkBlockRefSubtype":"s","TextMarkTextContent":"测试"},{"Type":"NodeText","Data":"不通过。"}]},{"ID":"20240311234521-on0vpfl","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240311234521-on0vpfl","updated":"20240311234521"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yysr"},{"Type":"NodeCodeBlockCode","Data":"// 检查 T().clear() 是一个合法表达式\n// 即 T 有一个无参构造且具有 clear() 函数\ntemplate\u003cclass T\u003e\nconcept check = requires {\n    T().clear();\n};\n\ntemplate\u003ccheck T\u003e\nstruct G {};\n\nint main() {\n    // 通过\n    G\u003cvector\u003cchar\u003e\u003e g1;\n    // 通过\n    G\u003cstring\u003e g2;\n    // error: template constraint failure for 'template\u003cclass T\u003e  requires  check\u003cT\u003e struct G'\n    G\u003carray\u003cchar, 10\u003e\u003e g3;\n    return 0;\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240311234521-6wztd7k","Type":"NodeParagraph","Properties":{"id":"20240311234521-6wztd7k","updated":"20240311234521"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"requires"},{"Type":"NodeText","Data":"​ 还支持形参表达式，但注意形参不具备生命周期和存储方式，只用于编译期检查，因此不支持需要运行时计算实参数量的不定参数，也不能对变量的具体值进行测试："}]},{"ID":"20240311234521-dtcczjo","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240311234521-dtcczjo","updated":"20240311234521"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yysr"},{"Type":"NodeCodeBlockCode","Data":"// 这个版本不检查构造函数\ntemplate\u003cclass T\u003e\nconcept check = requires(T t) {\n    t.clear();\n};\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240311234521-6j2u0pv","Type":"NodeParagraph","Properties":{"id":"20240311234521-6j2u0pv","style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);","updated":"20240311234803"},"Children":[{"Type":"NodeText","Data":"要求序列：对模板实参的若干要求形成的序列，分为简单要求、类型要求、复合要求和嵌套要求四种。"}]},{"ID":"20240311234521-twm030p","Type":"NodeList","ListData":{},"Properties":{"id":"20240311234521-twm030p","updated":"20240311234521"},"Children":[{"ID":"20240311234521-ftzno7c","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240311234521-ftzno7c","updated":"20240311234521"},"Children":[{"ID":"20240311234521-hw3ujv2","Type":"NodeParagraph","Properties":{"id":"20240311234521-hw3ujv2","updated":"20240311234521"},"Children":[{"Type":"NodeText","Data":"简单要求：不以 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"requires"},{"Type":"NodeText","Data":"​ 开始的要求，只断言表达式有效性，不进行求值，若替换失败则计算结果为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"false"},{"Type":"NodeText","Data":"​"}]}]}]},{"ID":"20240311234521-uwik6d4","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240311234521-uwik6d4","updated":"20240311234521"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yysr"},{"Type":"NodeCodeBlockCode","Data":"template\u003cclass T\u003e\nconcept C = requires(T a, T b) {\n    a + b;\n};\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240311234521-0dvjkpf","Type":"NodeList","ListData":{},"Properties":{"id":"20240311234521-0dvjkpf","updated":"20240311234521"},"Children":[{"ID":"20240311234521-simxrn2","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240311234521-simxrn2","updated":"20240311234521"},"Children":[{"ID":"20240311234521-f13ugie","Type":"NodeParagraph","Properties":{"id":"20240311234521-f13ugie","updated":"20240311234521"},"Children":[{"Type":"NodeText","Data":"类型要求：以 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"typename"},{"Type":"NodeText","Data":"​ 开始的要求，用于检查嵌套类型、类模板、别名模板特化的有效性。若模板替换失败则结果为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"false"},{"Type":"NodeText","Data":"​"}]}]}]},{"ID":"20240311234521-bsyfr4x","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240311234521-bsyfr4x","updated":"20240311234521"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yysr"},{"Type":"NodeCodeBlockCode","Data":"template\u003cclass T, class T::type = 0\u003e struct S;\ntemplate\u003cclass T\u003e using Ref = T\u0026;\ntemplate\u003cclass T\u003e concept C  = requires {\n    typename T::inner; // 检查嵌套类型\n    typename S\u003cT\u003e;     // 检查类模板特化\n    typename Ref\u003cT\u003e;   // 检查别名模板特化\n};\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240311234521-kb4s11o","Type":"NodeList","ListData":{},"Properties":{"id":"20240311234521-kb4s11o","updated":"20240311234521"},"Children":[{"ID":"20240311234521-kfi10bh","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240311234521-kfi10bh","updated":"20240311234521"},"Children":[{"ID":"20240311234521-wb75fod","Type":"NodeParagraph","Properties":{"id":"20240311234521-wb75fod","updated":"20240311234521"},"Children":[{"Type":"NodeText","Data":"复合要求：由 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"{ 表达式 }"},{"Type":"NodeText","Data":"​，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"noexcept"},{"Type":"NodeText","Data":"​，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"-\u0026gt; 返回类型约束"},{"Type":"NodeText","Data":"​ 组成的多个约束"}]},{"ID":"20240311234521-2ra1r2k","Type":"NodeList","ListData":{},"Properties":{"id":"20240311234521-2ra1r2k","updated":"20240311234521"},"Children":[{"ID":"20240311234521-465wezu","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240311234521-465wezu","updated":"20240311234521"},"Children":[{"ID":"20240311234521-gzqfnz5","Type":"NodeParagraph","Properties":{"id":"20240311234521-gzqfnz5","updated":"20240311234521"},"Children":[{"Type":"NodeText","Data":"替换模板实参，检查表达式有效性"}]}]},{"ID":"20240311234521-7nu6d85","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240311234521-7nu6d85","updated":"20240311234521"},"Children":[{"ID":"20240311234521-s1qfj5x","Type":"NodeParagraph","Properties":{"id":"20240311234521-s1qfj5x","updated":"20240311234521"},"Children":[{"Type":"NodeText","Data":"若存在 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"noexcept"},{"Type":"NodeText","Data":"​，检查表达式没有抛出异常的可能"}]}]},{"ID":"20240311234521-woblpuv","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240311234521-woblpuv","updated":"20240311234521"},"Children":[{"ID":"20240311234521-opl8ugo","Type":"NodeParagraph","Properties":{"id":"20240311234521-opl8ugo","updated":"20240311234521"},"Children":[{"Type":"NodeText","Data":"若存在 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"-\u0026gt;"},{"Type":"NodeText","Data":"​，则确保 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"decltype\u0026lt;表达式结果\u0026gt;"},{"Type":"NodeText","Data":"​ 满足返回类型约束"}]}]}]}]}]},{"ID":"20240311234521-0zhd72t","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240311234521-0zhd72t","updated":"20240311234521"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yysr"},{"Type":"NodeCodeBlockCode","Data":"template\u003cclass T\u003e\nconcept check = requires(T t1, T t2) {\n    { t1.clear() } noexcept;\n    { t1 + t2 } -\u003e same_as\u003cint\u003e;\n};\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240311234521-wq20wkx","Type":"NodeList","ListData":{},"Properties":{"id":"20240311234521-wq20wkx","updated":"20240311234521"},"Children":[{"ID":"20240311234521-1zeii7g","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240311234521-1zeii7g","updated":"20240311234521"},"Children":[{"ID":"20240311234521-91fetu4","Type":"NodeParagraph","Properties":{"id":"20240311234521-91fetu4","updated":"20240311234521"},"Children":[{"Type":"NodeText","Data":"嵌套要求：以 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"requires"},{"Type":"NodeText","Data":"​ 开始的要求，通常用于根据局部形参指定其他额外要求："}]}]}]},{"ID":"20240311234521-mulg10j","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240311234521-mulg10j","updated":"20240311234521"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yysr"},{"Type":"NodeCodeBlockCode","Data":"template\u003cclass T\u003e\nconcept check = requires(T t1, T t2) {\n    requires same_as\u003cdecltype(t1 + t2), int\u003e;\n    // 等同于\n    {t1 + t2} -\u003e same_as\u003cint\u003e;\n};\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]}