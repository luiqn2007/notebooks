{"ID":"20240311232509-ilnwpgf","Spec":"1","Type":"NodeDocument","Properties":{"icon":"2620-fe0f","id":"20240311232509-ilnwpgf","tags":"C++17","title":"自定义推导指引","updated":"20240311233145"},"Children":[{"ID":"20240311232903-qhtxdl6","Type":"NodeSuperBlock","Properties":{"id":"20240311232903-qhtxdl6","updated":"20240311232904"},"Children":[{"Type":"NodeSuperBlockOpenMarker"},{"Type":"NodeSuperBlockLayoutMarker","Data":"col"},{"ID":"20240311232605-l5mnsdq","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240311232605-l5mnsdq","updated":"20240311232904"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yysr"},{"Type":"NodeCodeBlockCode","Data":"int main() {\n    MyPair p1(10, 20);\n    // error: array used as initializer\n    MyPair p2(10, \"hello\");\n    return 0;\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240311232901-eqj0q8r","Type":"NodeSuperBlock","Properties":{"id":"20240311232901-eqj0q8r","updated":"20240311232904"},"Children":[{"Type":"NodeSuperBlockOpenMarker"},{"Type":"NodeSuperBlockLayoutMarker","Data":"row"},{"ID":"20240311232510-8zvzd95","Type":"NodeParagraph","Properties":{"id":"20240311232510-8zvzd95","updated":"20240311232902"},"Children":[{"Type":"NodeText","Data":"之前的 "},{"Type":"NodeTextMark","TextMarkType":"block-ref","TextMarkBlockRefID":"20240311232229-n8c106n","TextMarkBlockRefSubtype":"s","TextMarkTextContent":"MyPair"},{"Type":"NodeText","Data":" 中，如果使用该 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"main"},{"Type":"NodeText","Data":"​ 函数 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"p2"},{"Type":"NodeText","Data":"​ 对象无法编译成功，因为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"p2"},{"Type":"NodeText","Data":"​ 中类型为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"char[6]"},{"Type":"NodeText","Data":"​ 无法使用构造函数。"}]},{"ID":"20240311232844-w2wd8tl","Type":"NodeParagraph","Properties":{"id":"20240311232844-w2wd8tl","updated":"20240311232902"},"Children":[{"Type":"NodeText","Data":"STL 中 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"pair"},{"Type":"NodeText","Data":"​ 会将字符串退化成指针，于是有了 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"make_pair"},{"Type":"NodeText","Data":"​，在 C++11 使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"std::decay"},{"Type":"NodeText","Data":"​ 完成退化，C++11 之前使用函数传参进行退化。"}]},{"Type":"NodeSuperBlockCloseMarker"}]},{"Type":"NodeSuperBlockCloseMarker"}]},{"ID":"20240311232933-9hd2pgz","Type":"NodeParagraph","Properties":{"id":"20240311232933-9hd2pgz","updated":"20240311233125"},"Children":[{"Type":"NodeText","Data":"C++17 开始，支持"},{"Type":"NodeTextMark","TextMarkType":"block-ref","TextMarkBlockRefID":"20240310160951-q73e9sq","TextMarkBlockRefSubtype":"s","TextMarkTextContent":"类模板"},{"Type":"NodeText","Data":"的自定义推导指引，只需要使用类似"},{"Type":"NodeTextMark","TextMarkType":"block-ref","TextMarkBlockRefID":"20240311230126-qds5ork","TextMarkBlockRefSubtype":"s","TextMarkTextContent":"函数返回值后置"},{"Type":"NodeText","Data":"的语法声明即可，函数名使用类名。"}]},{"ID":"20240311232956-p1dw0dv","Type":"NodeSuperBlock","Properties":{"id":"20240311232956-p1dw0dv","updated":"20240311233138"},"Children":[{"Type":"NodeSuperBlockOpenMarker"},{"Type":"NodeSuperBlockLayoutMarker","Data":"col"},{"ID":"20240311232933-aukkq1t","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240311232933-aukkq1t","updated":"20240311233004"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yysr"},{"Type":"NodeCodeBlockCode","Data":"template\u003cclass F, class S\u003e\nstruct MyPair {\n    F _f;\n    S _s;\n\n    Pair(const F \u0026f, const S \u0026s): \n         _f(std::move(f)), _s(std::move(s)) {}\n};\n\ntemplate\u003cclass F, class S\u003e MyPair(F, S) -\u003e Pair\u003cF, S\u003e;\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240311232954-2qvje9x","Type":"NodeSuperBlock","Properties":{"id":"20240311232954-2qvje9x","updated":"20240311233138"},"Children":[{"Type":"NodeSuperBlockOpenMarker"},{"Type":"NodeSuperBlockLayoutMarker","Data":"row"},{"ID":"20240311232933-j537ur2","Type":"NodeParagraph","Properties":{"id":"20240311232933-j537ur2","updated":"20240311232955"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"template\u0026lt;class F, class S\u0026gt; Pair(F, S) -\u0026gt; Pair\u0026lt;F, S\u0026gt;"},{"Type":"NodeText","Data":"​ 就是一个典型的用户自定义推导指引。"}]},{"ID":"20240311232933-mizsfzo","Type":"NodeList","ListData":{},"Properties":{"id":"20240311232933-mizsfzo","updated":"20240311233138"},"Children":[{"ID":"20240311232933-rchm1n2","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240311232933-rchm1n2","updated":"20240311232933"},"Children":[{"ID":"20240311232933-tg257c0","Type":"NodeParagraph","Properties":{"id":"20240311232933-tg257c0","updated":"20240311232933"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"template\u0026lt;class F, class S\u0026gt;"},{"Type":"NodeText","Data":"​ 是类模板名"}]}]},{"ID":"20240311232933-7lolve7","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240311232933-7lolve7","updated":"20240311232933"},"Children":[{"ID":"20240311232933-24p6zco","Type":"NodeParagraph","Properties":{"id":"20240311232933-24p6zco","updated":"20240311232933"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Pair(F, S)"},{"Type":"NodeText","Data":"​ 是形参声明"}]}]},{"ID":"20240311232933-i0n66wl","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240311232933-i0n66wl","updated":"20240311233138"},"Children":[{"ID":"20240311232933-mhnt0rt","Type":"NodeParagraph","Properties":{"id":"20240311232933-mhnt0rt","updated":"20240311233138"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Pair\u0026lt;F, S\u0026gt;"},{"Type":"NodeText","Data":"​ 是指引的目标"},{"Type":"NodeTextMark","TextMarkType":"block-ref","TextMarkBlockRefID":"20240309023034-yq5ekrb","TextMarkBlockRefSubtype":"s","TextMarkTextContent":"类型"},{"Type":"NodeText","Data":"\n这条用户自定义推导表示，编译器直接推导按值传递的实参，即每个值不是以引用，而是以按值传递的形式推导类型，此时数组退化成了一个指针。"}]}]}]},{"Type":"NodeSuperBlockCloseMarker"}]},{"Type":"NodeSuperBlockCloseMarker"}]},{"ID":"20240311233021-zsxyj17","Type":"NodeParagraph","Properties":{"id":"20240311233021-zsxyj17","updated":"20240311233021"},"Children":[{"Type":"NodeText","Data":"实际推导方式非常灵活："}]},{"ID":"20240311233021-pomeka7","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240311233021-pomeka7","updated":"20240311233021"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yysr"},{"Type":"NodeCodeBlockCode","Data":"// 使用 std::common_type 将多个不同类型统一成相同类型存入 vector\n// 例如：int, unsigned int, double 统一成 double\nnamespace std {\n    template\u003cclass ...T\u003e\n    vector(T\u0026\u0026 ...t) -\u003e vector\u003cstd::common_type_t\u003cT...\u003e\u003e;\n}\n\n// 将 const char* 推导为 std::string\ntemplate\u003cclass F\u003e Pair(F, const char*) -\u003e Pair\u003cF, std::string\u003e;\n\n// 要求使用显式对象构造（p = {1, \"2\"} 的形式无法编译）\ntemplate Pair(int, const char*) -\u003e Pair\u003clong long, std::string\u003e;\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240311233021-upgzje4","Type":"NodeParagraph","Properties":{"id":"20240311233021-upgzje4","updated":"20240311233145"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"tag","TextMarkTextContent":"C++20"},{"Type":"NodeText","Data":"​ 开始，支持"},{"Type":"NodeTextMark","TextMarkType":"block-ref","TextMarkBlockRefID":"20240311103402-rz5zivz","TextMarkBlockRefSubtype":"s","TextMarkTextContent":"聚合类型"},{"Type":"NodeText","Data":"类模板的推导指引"}]},{"ID":"20240311233021-lgn2r0l","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240311233021-lgn2r0l","updated":"20240311233021"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yysr"},{"Type":"NodeCodeBlockCode","Data":"template\u003cclass T\u003e\nstruct Wrap {\n    T data;\n};\n\ntemplate\u003cclass T\u003e Wrap(T) -\u003e Wrap\u003cT\u003e;\n\nint main() {\n    // ok\n    Wrap w = {7};\n    return 0;\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]}