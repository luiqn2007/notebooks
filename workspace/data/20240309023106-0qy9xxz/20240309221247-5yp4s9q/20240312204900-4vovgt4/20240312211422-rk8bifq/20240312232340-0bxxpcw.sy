{"ID":"20240312232340-0bxxpcw","Spec":"1","Type":"NodeDocument","Properties":{"icon":"1f921","id":"20240312232340-0bxxpcw","title":"栈帧","updated":"20240313002931"},"Children":[{"ID":"20240312232340-qiixtkb","Type":"NodeParagraph","Properties":{"id":"20240312232340-qiixtkb","updated":"20240313000245"},"Children":[{"Type":"NodeText","Data":"Hotspot VM 使用的是"},{"Type":"NodeTextMark","TextMarkType":"block-ref","TextMarkBlockRefID":"20240312211422-rk8bifq","TextMarkBlockRefSubtype":"s","TextMarkTextContent":"基于栈"},{"Type":"NodeText","Data":"的虚拟机，每个线程有一个虚拟机栈来存放栈帧，每个方法的调用都包含栈帧的创建、销毁。当某个栈容量超过 JVM 允许的"},{"Type":"NodeTextMark","TextMarkType":"inline-memo","TextMarkInlineMemoContent":"可使用 -Xss 指定，如 -Xss:256k","TextMarkTextContent":"最大容量"},{"Type":"NodeText","Data":"，产生 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"StackOverflowError"},{"Type":"NodeText","Data":"​ 异常。"}]},{"ID":"20240313000245-lpq9t0r","Type":"NodeParagraph","Properties":{"id":"20240313000245-lpq9t0r","updated":"20240313000358"},"Children":[{"Type":"NodeText","Data":"每个栈帧中都包含自己的"},{"Type":"NodeTextMark","TextMarkType":"inline-memo","TextMarkInlineMemoContent":"Local Variable","TextMarkTextContent":"变量表"},{"Type":"NodeText","Data":"、"},{"Type":"NodeTextMark","TextMarkType":"inline-memo","TextMarkInlineMemoContent":"Operand Stack","TextMarkTextContent":"操作数栈"},{"Type":"NodeText","Data":"和指向常量池的引用。"}]},{"ID":"20240313002723-ipxyfcp","Type":"NodeParagraph","Properties":{"id":"20240313002723-ipxyfcp","style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);","updated":"20240313002927"},"Children":[{"Type":"NodeText","Data":"栈帧的局部变量表保存变量，其大小为作用域中同时存在的值的最大数量"}]},{"ID":"20240313000358-zzurb2f","Type":"NodeParagraph","Properties":{"id":"20240313000358-zzurb2f","updated":"20240313001157"},"Children":[{"Type":"NodeText","Data":"局部变量表大小和内容在编译前便已经确定，即 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"max_locals"},{"Type":"NodeText","Data":"​ 字段，可以通过 "},{"Type":"NodeTextMark","TextMarkType":"code block-ref","TextMarkBlockRefID":"20240312204352-x1wehcb","TextMarkBlockRefSubtype":"s","TextMarkTextContent":"-v"},{"Type":"NodeText","Data":"​查看，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"LocalVariableTable"},{"Type":"NodeText","Data":"​ 即局部变量表。"}]},{"ID":"20240313001133-n5mtyc4","Type":"NodeSuperBlock","Properties":{"id":"20240313001133-n5mtyc4","updated":"20240313001322"},"Children":[{"Type":"NodeSuperBlockOpenMarker"},{"Type":"NodeSuperBlockLayoutMarker","Data":"col"},{"ID":"20240313001000-qru6aic","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240313001000-qru6aic","updated":"20240313001134"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"void foo(int id, String name) {\n    String tmp = \"A\";\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240313001321-bvvdmrh","Type":"NodeSuperBlock","Properties":{"id":"20240313001321-bvvdmrh","updated":"20240313001322"},"Children":[{"Type":"NodeSuperBlockOpenMarker"},{"Type":"NodeSuperBlockLayoutMarker","Data":"row"},{"ID":"20240313001310-exjav0g","Type":"NodeParagraph","Properties":{"id":"20240313001310-exjav0g","updated":"20240313001322"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240313001310-sjtz35a.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240313001130-y6gifu8","Type":"NodeParagraph","Properties":{"id":"20240313001130-y6gifu8","updated":"20240313001322"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240313001131-prsqxh8.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeSuperBlockCloseMarker"}]},{"Type":"NodeSuperBlockCloseMarker"}]},{"ID":"20240313001153-l32i74s","Type":"NodeParagraph","Properties":{"id":"20240313001153-l32i74s","updated":"20240313002229"},"Children":[{"Type":"NodeText","Data":"可以看到，方法的局部变量表有 4 个槽（"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"locals=4"},{"Type":"NodeText","Data":"​），参数数量为 3（"},{"Type":"NodeTextMark","TextMarkType":"code inline-memo","TextMarkInlineMemoContent":"成员函数隐式传入一个参数 this","TextMarkTextContent":"args_size=3"},{"Type":"NodeText","Data":"​），操作数栈深度为 1（"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Stack=1"},{"Type":"NodeText","Data":"​）。"}]},{"ID":"20240313001815-4t4mxi2","Type":"NodeSuperBlock","Properties":{"id":"20240313001815-4t4mxi2","updated":"20240313001906"},"Children":[{"Type":"NodeSuperBlockOpenMarker"},{"Type":"NodeSuperBlockLayoutMarker","Data":"col"},{"ID":"20240313001647-f7ai1kj","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240313001647-f7ai1kj","updated":"20240313001816"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"public static void foo() {\n    if (true) {\n        String a = \"a\";\n    }\n    if (true) {\n        String b = \"b\";\n    }\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240313001854-5iwksaa","Type":"NodeSuperBlock","Properties":{"id":"20240313001854-5iwksaa","updated":"20240313001906"},"Children":[{"Type":"NodeSuperBlockOpenMarker"},{"Type":"NodeSuperBlockLayoutMarker","Data":"row"},{"ID":"20240313001859-7rw71ah","Type":"NodeParagraph","Properties":{"id":"20240313001859-7rw71ah"}},{"ID":"20240313001906-htdpev9","Type":"NodeParagraph","Properties":{"id":"20240313001906-htdpev9"}},{"ID":"20240313001322-g1nvgm7","Type":"NodeParagraph","Properties":{"id":"20240313001322-g1nvgm7","updated":"20240313001821"},"Children":[{"Type":"NodeText","Data":"该函数则 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"max_locals=1"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240313001825-49fu8b5","Type":"NodeList","ListData":{},"Properties":{"id":"20240313001825-49fu8b5","updated":"20240313001855"},"Children":[{"ID":"20240313001826-zc0kzpq","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240313001826-zc0kzpq","updated":"20240313001826"},"Children":[{"ID":"20240313001826-i538iwk","Type":"NodeParagraph","Properties":{"id":"20240313001826-i538iwk","updated":"20240313001826"},"Children":[{"Type":"NodeText","Data":"由于 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"a"},{"Type":"NodeText","Data":"​，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"b"},{"Type":"NodeText","Data":"​ 的作用域不同，其所占槽位可以复用。"}]}]},{"ID":"20240313001828-tl5yqrw","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240313001828-tl5yqrw","updated":"20240313001849"},"Children":[{"ID":"20240313001828-lj9mxow","Type":"NodeParagraph","Properties":{"id":"20240313001828-lj9mxow","updated":"20240313001849"},"Children":[{"Type":"NodeText","Data":"静态函数没有隐式传入的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"this"},{"Type":"NodeText","Data":"​，因此 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"args_size=0"},{"Type":"NodeText","Data":"​"}]}]}]},{"Type":"NodeSuperBlockCloseMarker"}]},{"Type":"NodeSuperBlockCloseMarker"}]},{"ID":"20240313002814-7op744u","Type":"NodeParagraph","Properties":{"id":"20240313002814-7op744u","style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);","updated":"20240313002931"},"Children":[{"Type":"NodeText","Data":"栈帧的操作数栈保存指令操作数，其大小通过每次调用指令时+n，出栈时-n 的方式计算"}]},{"ID":"20240313001816-wvnobed","Type":"NodeParagraph","Properties":{"id":"20240313001816-wvnobed","updated":"20240313002330"},"Children":[{"Type":"NodeText","Data":"栈帧中还包含一个操作数栈，用于保存每个操作码的操作数。操作数栈遵循 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"LIFO"},{"Type":"NodeText","Data":"​ 栈结构，其深度也会在编译时确定。"}]},{"ID":"20240313002421-ibc6vtu","Type":"NodeParagraph","Properties":{"id":"20240313002421-ibc6vtu","updated":"20240313002535"},"Children":[{"Type":"NodeText","Data":"虚拟机的每个操作都是在不断地将局部变量表的数据入栈、将栈顶数据存入局部变量表的过程。"}]},{"ID":"20240313002551-sp49yai","Type":"NodeParagraph","Properties":{"id":"20240313002551-sp49yai","updated":"20240313002624"},"Children":[{"Type":"NodeText","Data":"每当要执行一条指令时，先将"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"this"},{"Type":"NodeText","Data":"​（如果存在）和指令所需要的参数入栈，指令在执行中根据需要从栈顶出栈取数据，调用完毕后如果有返回值则将返回值入栈。"}]},{"ID":"20240313002231-da53kjc","Type":"NodeParagraph","Properties":{"id":"20240313002231-da53kjc"}}]}